-- DATA DEFINITION LANGUAGE STATEMENTS

CREATE TABLE EMP2
(EMPNO NUMBER);

--TABLE NAME CAN BE UPTO 128 CHARS FOR ORACLE 12.2

-- TABLE NAME CANNOT BE RESERVED WORD
CREATE TABLE SELECT
(EMPNO NUMBER);

-- DATA TYPES
CREATE TABLE TEST
( N1 NUMBER,
  N2 NUMBER(5,3));
  
INSERT INTO TEST (N1, N2)
VALUES           (20.25, 23.35534); -- HERE ORACLE ROUNDS THE DECIMAL TO 3 PLACES

INSERT INTO TEST
VALUES (100, 213.455); -- ERROR THROWN DUE TO NUMBER EXCEEDING PRECISION

-- CLOB RECOMMENDED INSTEAD OF LONG

-- CREATE TABLE
CREATE TABLE XX_EMP_TEST
( EMP_ID NUMBER,
  ENAME VARCHAR2(100),
  SALARY NUMBER(8,2),
  EMP_PIC BLOB
);

-- USING "" WILL MAKE IT CASE-SENSITIVE
-- AND HAS TO BE RETRIEVED USING DUOBLE QUOTES

-- USING DEFAULT
CREATE TABLE XX_EMP_TEST1
( EMP_ID NUMBER,
  ENAME VARCHAR2(100),
  START_DATE DATE DEFAULT SYSDATE
);

INSERT INTO XX_EMP_TEST1 (EMP_ID, ENAME)
VALUES (1, 'Nisu');

COMMIT;

SELECT * FROM XX_EMP_TEST1;

-- USING DICTIONARY TABLES
SELECT TABLE_NAME FROM USER_TABLES;

SELECT TABLE_NAME FROM ALL_TABLES
WHERE OWNER='HR';

-- CONSTRAINTS FOR CREATING TABLES
-- COLUMN LEVEL (TABLE LEVEL IS RECOMMENDED)
CREATE TABLE XX_EMP_COL_CONST
( EMP_ID NUMBER CONSTRAINT XX_EMP_COL_CONST_PK PRIMARY KEY,
  ENAME VARCHAR2(100) CONSTRAINT XX_EMP_COL_CONST_UK1 UNIQUE,
  SALARY NUMBER NOT NULL,
  GENDER CHAR(1) CONSTRAINT XX_EMP_COL_CONST_CHQ CHECK(GENDER IN ('M', 'F')),
  -- FOREIGN KEY SHOULD MATCH PRIMARY OR UNIQUE KEY IN ANOTHER TABLE
  DEPT_ID NUMBER CONSTRAINT XX_EMP_COL_CONST_FK1 REFERENCES DEPARTMENTS (DEPARTMENT_ID)
);

-- VIEWING CONSTRAINTS
SELECT * FROM USER_CONSTRAINTS
WHERE TABLE_NAME = 'XX_EMP_COL_CONST';

-- TABLE-LEVEL CONSTRAINTS
-- CAN MAKE PK HAVING MORE THAN ONE COLUMN
-- ALL CONSTRAINTS HAVE TO BE NAMED
CREATE TABLE XX_EMP_COL_CONST1
( EMP_ID1 NUMBER,
  EMP_ID2 NUMBER,
  ENAME VARCHAR2(100),
  SALARY NUMBER NOT NULL, -- CANNOT BE MADE AT TABLE LEVEL
  GENDER CHAR(1),
  DEPT_ID NUMBER,
  CONSTRAINT XX_EMP_COL_CONST1_PK PRIMARY KEY (EMP_ID1, EMP_ID2),
  CONSTRAINT XX_EMP_COL_CONST1_UK1 UNIQUE (ENAME),
  CONSTRAINT XX_EMP_COL_CONST1_CHQ CHECK (GENDER IN ('M', 'F')),
  CONSTRAINT XX_EMP_COL_CONST1_FK1 FOREIGN KEY (DEPT_ID) REFERENCES DEPARTMENTS (DEPARTMENT_ID)
);
-- ONLY 1 PRIMARY KEY CAN BE IN A TABLE
-- NO SUCH LIMITATION FOR UNIQUE
-- ORACLE CREATES INDEXES AUTOMATICALLY ON PRIMARY AND UNIQUE KEYS
-- FOREIGN KEY VALUE MUST MATCH EXISTING VALUE IN PARENT TABLE OR BE NULL

-- ON DELETE CASCADE/ ON DELETE SET NULL
DELETE FROM DEPARTMENTS; -- CANNOT DELETE DUE TO CHILD CONSTRAINTS

CREATE TABLE DEPT1
( DEPTNO NUMBER,
  DNAME VARCHAR2(100),
  CONSTRAINT DEPT1_PK PRIMARY KEY (DEPTNO)
);

INSERT INTO DEPT1 (DEPTNO, DNAME)
VALUES            (1, 'HR_DEPT');
INSERT INTO DEPT1 (DEPTNO, DNAME)
VALUES            (2, 'PO_DEPT');
COMMIT;

SELECT * FROM DEPT1;

CREATE TABLE EMP1
( EMPID NUMBER PRIMARY KEY,
  ENAME VARCHAR2(100),
  DEPT_NO NUMBER,
  CONSTRAINT EMP1_FK FOREIGN KEY (DEPT_NO) REFERENCES DEPT1 (DEPTNO) ON DELETE CASCADE
);

INSERT INTO EMP1 VALUES (1, 'SAM', '1'); -- CHAR DEPTNO HERE WAS COERCED TO NUMBER
INSERT INTO EMP1 VALUES (2, 'TIM', '1');
INSERT INTO EMP1 VALUES (3, 'TOM', '1');
INSERT INTO EMP1 VALUES (4, 'RAM', '2');
INSERT INTO EMP1 VALUES (5, 'JIM', '2');
COMMIT;

SELECT * FROM EMP1;

DELETE FROM DEPT1
WHERE DEPTNO=2;

-- ON DELETING MASTER RECORD, ALL DEPENDENT RECORDS ARE ALSO DELETED
SELECT * FROM EMP1;

-- ON DELETE SET NULL
CREATE TABLE DEPT2
( DEPTNO NUMBER,
  DNAME VARCHAR2(100),
  CONSTRAINT DEPT2_PK PRIMARY KEY (DEPTNO)
);

INSERT INTO DEPT2 (DEPTNO, DNAME)
VALUES            (1, 'HR_DEPT');
INSERT INTO DEPT2 (DEPTNO, DNAME)
VALUES            (2, 'PO_DEPT');
COMMIT;

CREATE TABLE EMP3
( EMPID NUMBER,
  ENAME VARCHAR2(100),
  DEPTNO NUMBER,
  CONSTRAINT EMP3_PK PRIMARY KEY (EMPID),
  CONSTRAINT EMP3_FK FOREIGN KEY (DEPTNO) REFERENCES DEPT2 (DEPTNO) ON DELETE SET NULL
);

INSERT INTO EMP3 VALUES (1, 'SAM', 1); 
INSERT INTO EMP3 VALUES (2, 'TIM', 1);
INSERT INTO EMP3 VALUES (3, 'TOM', 1);
INSERT INTO EMP3 VALUES (4, 'RAM', 2);
INSERT INTO EMP3 VALUES (5, 'JIM', 2);
COMMIT;

SELECT * FROM EMP3;

DELETE FROM DEPT2
WHERE DEPTNO=2;

SELECT * FROM EMP3; -- NOW DEPTNO HAS BEEN SET TO NULL, INSTEAD OF WHOLE RECORD
-- BEING DELETED

-- CREATE TABLE USING SUBQUERY
-- ONLY NOT-NULL CONSTRAINT IS COPIED
-- PK, FK ETC IS NOT COPIED
CREATE TABLE EMP_D90
AS 
  SELECT EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY, DEPARTMENT_ID
  FROM EMPLOYEES
  WHERE DEPARTMENT_ID=90;

-- COLUMN NAMES APPEAR EXACTLY LIKE THE SELECT STATEMENT ABOVE
  
SELECT * FROM EMP_D90;

-- THE NOT NULL CONSTRAINT OF THE PRIMARY KEY OF PARENT TABLE
-- IS ALSO NOT COPIED
DESC EMP_D90;

-- TO GIVE DIFFERENT NAMES, SPECIFY IT NEXT TO NEW TABLE NAME
-- CAN ALSO SPECIFY DEFAULT VALUES HERE
CREATE TABLE NAMED_EMP_D90 (EMPID, FNAME, LNAME, SAL DEFAULT 0, DEPTID)
AS
  SELECT EMPLOYEE_ID, FIRST_NAME, LAST_NAME, SALARY, DEPARTMENT_ID
  FROM EMPLOYEES
  WHERE DEPARTMENT_ID=90;
  
SELECT * FROM NAMED_EMP_D90;

-- ALTER TABLE


